<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=zh-cn dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>搭建易于访问的私人 PeerTube 实例 - 🍤 金鱼的记忆仓库</title><meta name=theme-color><meta name=description content="本文旨在描述如何通过虚拟主机与对象存储，配置易于私人使用的 PeerTube 实例。教程并不适用供大规模访问的网站架设。
虽然说只要 VPS 访问起来没有问题，不用对象存储也是没有问题的。但从经费的角度上，购买高带宽的对象存储总要比高带宽的 VPS 来的省钱。所以对于本文的目标读者，我还是建议使用对象存储。
事前准备

一台 VPS（本文以 Ubuntu/Debian 为例）
对象存储服务（本文以 Backblaze B2 为例）
个人域名或子域名
习惯使用 Linux 的大脑

配置对象存储
首先你需要配置一个供 PeerTube 保存其影片的对象存储池。PeerTube 支持 Amazon S3，或 Backblaze B2，你用哪个都行。
访问密钥
你需要从你选择的服务商建立一个访问用的 Key，并将：

App Key ID
App Key

记录下来以备稍后使用。
存储池
之后建立一个给 PeerTube 使用的池，并将池设置为公开（Public），记录下：

名字
终结点（Endpoint，即对象存储的主域名）
地区（只有 Amazon S3 需要）

配置 CORS
CORS 其实就是防盗链。你肯定不希望什么网站都外链你的视频出去播放。在上一步已经设置为公开的基础上，点击 “CORS Rules” 按钮进行配置。
选择：Share everything in this bucket with this one origin.
并在其下方写下你将会使用的域名。需包含 https://，端口号可以没有。
CORS 配置大概需要十分钟左右的时间来生效，正好可以来安装我们的网站。
安装 PeerTube
PeerTube 的安装是非常麻烦的，所以有很多人会选择使用 Docker 进行安装，但假如你对 Docker 并不熟悉，后续配置的时候可能会十分头疼。所以这里我们将直接进行安装。本文默认你在非 root 的 sudo user 下进行操作，其他情况请自行调整。"><meta name=author content="🍤 金鱼的记忆仓库"><link rel="preload stylesheet" as=style href=https://blog.megabits.xyz/main.min.css><link rel=preload as=image href=https://blog.megabits.xyz/theme.png><link rel=preload as=image href=https://blog.megabits.xyz/twitter.svg><link rel=preload as=image href=https://blog.megabits.xyz/github.svg><link rel=preload as=image href=https://blog.megabits.xyz/instagram.svg><script defer src=https://blog.megabits.xyz/highlight.min.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://blog.megabits.xyz/favicon.ico><link rel=apple-touch-icon href=https://blog.megabits.xyz/apple-touch-icon.png><meta name=generator content="Hugo 0.148.1"><meta itemprop=name content="搭建易于访问的私人 PeerTube 实例"><meta itemprop=description content="本文旨在描述如何通过虚拟主机与对象存储，配置易于私人使用的 PeerTube 实例。教程并不适用供大规模访问的网站架设。
虽然说只要 VPS 访问起来没有问题，不用对象存储也是没有问题的。但从经费的角度上，购买高带宽的对象存储总要比高带宽的 VPS 来的省钱。所以对于本文的目标读者，我还是建议使用对象存储。
事前准备 一台 VPS（本文以 Ubuntu/Debian 为例） 对象存储服务（本文以 Backblaze B2 为例） 个人域名或子域名 习惯使用 Linux 的大脑 配置对象存储 首先你需要配置一个供 PeerTube 保存其影片的对象存储池。PeerTube 支持 Amazon S3，或 Backblaze B2，你用哪个都行。
访问密钥 你需要从你选择的服务商建立一个访问用的 Key，并将：
App Key ID App Key 记录下来以备稍后使用。
存储池 之后建立一个给 PeerTube 使用的池，并将池设置为公开（Public），记录下：
名字 终结点（Endpoint，即对象存储的主域名） 地区（只有 Amazon S3 需要） 配置 CORS CORS 其实就是防盗链。你肯定不希望什么网站都外链你的视频出去播放。在上一步已经设置为公开的基础上，点击 “CORS Rules” 按钮进行配置。
选择：Share everything in this bucket with this one origin.
并在其下方写下你将会使用的域名。需包含 https://，端口号可以没有。
CORS 配置大概需要十分钟左右的时间来生效，正好可以来安装我们的网站。
安装 PeerTube PeerTube 的安装是非常麻烦的，所以有很多人会选择使用 Docker 进行安装，但假如你对 Docker 并不熟悉，后续配置的时候可能会十分头疼。所以这里我们将直接进行安装。本文默认你在非 root 的 sudo user 下进行操作，其他情况请自行调整。"><meta itemprop=datePublished content="2022-02-10T00:00:00+09:00"><meta itemprop=dateModified content="2022-02-10T00:00:00+09:00"><meta itemprop=wordCount content="548"><meta property="og:url" content="https://blog.megabits.xyz/dev-posts/peertube/"><meta property="og:site_name" content="🍤 金鱼的记忆仓库"><meta property="og:title" content="搭建易于访问的私人 PeerTube 实例"><meta property="og:description" content="本文旨在描述如何通过虚拟主机与对象存储，配置易于私人使用的 PeerTube 实例。教程并不适用供大规模访问的网站架设。
虽然说只要 VPS 访问起来没有问题，不用对象存储也是没有问题的。但从经费的角度上，购买高带宽的对象存储总要比高带宽的 VPS 来的省钱。所以对于本文的目标读者，我还是建议使用对象存储。
事前准备 一台 VPS（本文以 Ubuntu/Debian 为例） 对象存储服务（本文以 Backblaze B2 为例） 个人域名或子域名 习惯使用 Linux 的大脑 配置对象存储 首先你需要配置一个供 PeerTube 保存其影片的对象存储池。PeerTube 支持 Amazon S3，或 Backblaze B2，你用哪个都行。
访问密钥 你需要从你选择的服务商建立一个访问用的 Key，并将：
App Key ID App Key 记录下来以备稍后使用。
存储池 之后建立一个给 PeerTube 使用的池，并将池设置为公开（Public），记录下：
名字 终结点（Endpoint，即对象存储的主域名） 地区（只有 Amazon S3 需要） 配置 CORS CORS 其实就是防盗链。你肯定不希望什么网站都外链你的视频出去播放。在上一步已经设置为公开的基础上，点击 “CORS Rules” 按钮进行配置。
选择：Share everything in this bucket with this one origin.
并在其下方写下你将会使用的域名。需包含 https://，端口号可以没有。
CORS 配置大概需要十分钟左右的时间来生效，正好可以来安装我们的网站。
安装 PeerTube PeerTube 的安装是非常麻烦的，所以有很多人会选择使用 Docker 进行安装，但假如你对 Docker 并不熟悉，后续配置的时候可能会十分头疼。所以这里我们将直接进行安装。本文默认你在非 root 的 sudo user 下进行操作，其他情况请自行调整。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="dev-posts"><meta property="article:published_time" content="2022-02-10T00:00:00+09:00"><meta property="article:modified_time" content="2022-02-10T00:00:00+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="搭建易于访问的私人 PeerTube 实例"><meta name=twitter:description content="本文旨在描述如何通过虚拟主机与对象存储，配置易于私人使用的 PeerTube 实例。教程并不适用供大规模访问的网站架设。
虽然说只要 VPS 访问起来没有问题，不用对象存储也是没有问题的。但从经费的角度上，购买高带宽的对象存储总要比高带宽的 VPS 来的省钱。所以对于本文的目标读者，我还是建议使用对象存储。
事前准备 一台 VPS（本文以 Ubuntu/Debian 为例） 对象存储服务（本文以 Backblaze B2 为例） 个人域名或子域名 习惯使用 Linux 的大脑 配置对象存储 首先你需要配置一个供 PeerTube 保存其影片的对象存储池。PeerTube 支持 Amazon S3，或 Backblaze B2，你用哪个都行。
访问密钥 你需要从你选择的服务商建立一个访问用的 Key，并将：
App Key ID App Key 记录下来以备稍后使用。
存储池 之后建立一个给 PeerTube 使用的池，并将池设置为公开（Public），记录下：
名字 终结点（Endpoint，即对象存储的主域名） 地区（只有 Amazon S3 需要） 配置 CORS CORS 其实就是防盗链。你肯定不希望什么网站都外链你的视频出去播放。在上一步已经设置为公开的基础上，点击 “CORS Rules” 按钮进行配置。
选择：Share everything in this bucket with this one origin.
并在其下方写下你将会使用的域名。需包含 https://，端口号可以没有。
CORS 配置大概需要十分钟左右的时间来生效，正好可以来安装我们的网站。
安装 PeerTube PeerTube 的安装是非常麻烦的，所以有很多人会选择使用 Docker 进行安装，但假如你对 Docker 并不熟悉，后续配置的时候可能会十分头疼。所以这里我们将直接进行安装。本文默认你在非 root 的 sudo user 下进行操作，其他情况请自行调整。"><link rel=canonical href=https://blog.megabits.xyz/dev-posts/peertube/></head><body class="bg-(--bg) text-black antialiased duration-200 ease-out [-webkit-tap-highlight-color:transparent] dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-(--w) px-8 whitespace-nowrap lg:justify-center"><div class="relative z-50 flex items-center ltr:mr-auto rtl:ml-auto"><a class="-translate-y-[1px] text-2xl font-medium" href=https://blog.megabits.xyz/>🍤 金鱼的记忆仓库</a><div class="btn-dark text-[0px] ltr:ml-4 rtl:mr-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden ltr:-mr-8 rtl:-ml-8" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#faf8f1".replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full flex-col justify-center bg-(--bg) pb-16 duration-200 select-none lg:static lg:h-auto lg:flex-row lg:bg-transparent! lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-10 rtl:space-x-reverse"><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/dev-posts/>技术文章</a></nav><nav class="mt-12 flex justify-center space-x-10 lg:mt-0 lg:items-center ltr:lg:ml-14 rtl:space-x-reverse rtl:lg:mr-14 dark:invert"><a class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./twitter.svg) href=https://twitter.com/Megabits_mzq target=_blank rel=me>twitter</a>
<a class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/megabitsenmzq target=_blank rel=me>github</a>
<a class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./instagram.svg) href=https://instagram.com/megabits_mzq target=_blank rel=me>instagram</a></nav></div></header><main class="prose prose-neutral dark:prose-invert relative mx-auto min-h-[calc(100vh-9rem)] max-w-(--w) px-8 pt-14 pb-16"><article><header class=mb-14><h1 class="my-0! pb-2.5">搭建易于访问的私人 PeerTube 实例</h1><div class="text-xs antialiased opacity-60"><time>Feb 10, 2022</time></div></header><section><p>本文旨在描述如何通过虚拟主机与对象存储，配置易于私人使用的 PeerTube 实例。教程并不适用供大规模访问的网站架设。</p><p>虽然说只要 VPS 访问起来没有问题，不用对象存储也是没有问题的。但从经费的角度上，购买高带宽的对象存储总要比高带宽的 VPS 来的省钱。所以对于本文的目标读者，我还是建议使用对象存储。</p><h2 id=事前准备>事前准备</h2><ol><li>一台 VPS（本文以 Ubuntu/Debian 为例）</li><li>对象存储服务（本文以 Backblaze B2 为例）</li><li>个人域名或子域名</li><li>习惯使用 Linux 的大脑</li></ol><h2 id=配置对象存储>配置对象存储</h2><p>首先你需要配置一个供 PeerTube 保存其影片的对象存储池。PeerTube 支持 Amazon S3，或 Backblaze B2，你用哪个都行。</p><h3 id=访问密钥>访问密钥</h3><p>你需要从你选择的服务商建立一个访问用的 Key，并将：</p><ol><li>App Key ID</li><li>App Key</li></ol><p>记录下来以备稍后使用。</p><h3 id=存储池>存储池</h3><p>之后建立一个给 PeerTube 使用的池，并将池设置为<strong>公开（Public）</strong>，记录下：</p><ol><li>名字</li><li>终结点（Endpoint，即对象存储的主域名）</li><li>地区（只有 Amazon S3 需要）</li></ol><h3 id=配置-cors>配置 CORS</h3><p>CORS 其实就是防盗链。你肯定不希望什么网站都外链你的视频出去播放。在上一步已经设置为公开的基础上，点击 <strong>“CORS Rules”</strong> 按钮进行配置。</p><p>选择：Share everything in this bucket with this one origin.</p><p>并在其下方写下你将会使用的域名。需包含 https://，端口号可以没有。</p><p>CORS 配置大概需要十分钟左右的时间来生效，正好可以来安装我们的网站。</p><h2 id=安装-peertube>安装 PeerTube</h2><p>PeerTube 的安装是非常麻烦的，所以有很多人会选择使用 Docker 进行安装，但假如你对 Docker 并不熟悉，后续配置的时候可能会十分头疼。所以这里我们将直接进行安装。本文默认你在非 root 的 sudo user 下进行操作，其他情况请自行调整。</p><h3 id=前置准备>前置准备</h3><p>安装 Node.js：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install build-essential gnupg curl wget unzip
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -sL https://deb.nodesource.com/setup_lts.x | sudo bash -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo apt install nodejs
</span></span><span style=display:flex><span>sudo npm i -g yarn
</span></span></code></pre></div><p>安装其他包：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install git python-dev ffmpeg postgresql postgresql-contrib redis-server
</span></span></code></pre></div><p>此处我们没有安装 nginx，因为我将会在后文使用 Caddy2 作为 Web 服务器。</p><p>启动数据库：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl enable --now postgresql redis-server
</span></span></code></pre></div><p>建立 PeerTube 用户并设置其密码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo useradd -m -d /var/www/peertube -s /bin/bash peertube
</span></span><span style=display:flex><span>sudo passwd peertube
</span></span></code></pre></div><p>配置 PostgreSQL 用户和数据库：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo -u postgres createuser -P peertube
</span></span><span style=display:flex><span>sudo -u postgres createdb -O peertube -E UTF8 -T template0 peertube_prod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo -u postgres psql -c <span style=color:#e6db74>&#34;CREATE EXTENSION pg_trgm;&#34;</span> peertube_prod
</span></span><span style=display:flex><span>sudo -u postgres psql -c <span style=color:#e6db74>&#34;CREATE EXTENSION unaccent;&#34;</span> peertube_prod
</span></span></code></pre></div><p>此处第一条命令后你会被要求输入数据库的访问密码，后面我们会用到。</p><h3 id=安装-peertube-1>安装 PeerTube</h3><p>首先进入到 peertube 用户下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>su - peertube
</span></span></code></pre></div><p>下载最新版的 PeerTube：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir config storage versions <span style=color:#f92672>&amp;&amp;</span> cd versions
</span></span><span style=display:flex><span>wget https://github.com/Chocobozzz/PeerTube/releases/download/v4.0.0/peertube-v4.0.0.zip
</span></span><span style=display:flex><span>unzip peertube-v4.0.0.zip
</span></span><span style=display:flex><span>ln -s /var/www/peertube/versions/peertube-v4.0.0 ../peertube-latest
</span></span></code></pre></div><p>本文编写时 PeerTube 的最新版本是 4.0，其他版本可以从 <a href=https://github.com/Chocobozzz/PeerTube/releases>GitHub</a> 获取。</p><p>安装：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd ../peertube-latest
</span></span><span style=display:flex><span>yarn install --production --pure-lockfile
</span></span></code></pre></div><p>安装过程中可能会出现一些警告，不用管他。</p><h3 id=调整配置文件>调整配置文件</h3><p>首先从模版创建新的配置文件并打开：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cp config/default.yaml /var/www/peertube/config/default.yaml
</span></span><span style=display:flex><span>cp config/production.yaml.example /var/www/peertube/config/production.yaml
</span></span><span style=display:flex><span>nano /var/www/peertube/config/production.yaml
</span></span></code></pre></div><p>此处使用的是 nano 编辑器，使用方法非常简单，99.9% 的时候都只用 Crtl+O 保存，Ctrl+X 退出。</p><p>需要改动的地方有以下几点：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>webserver:
</span></span><span style=display:flex><span>  https: true
</span></span><span style=display:flex><span>  hostname: <span style=color:#e6db74>&#39;peertube.imlala.best&#39;</span> <span style=color:#75715e># 你的域名</span>
</span></span><span style=display:flex><span>  port: <span style=color:#ae81ff>443</span>
</span></span></code></pre></div><p>如果你希望使用 http 进行测试，可以暂时改为 80 端口。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>database:
</span></span><span style=display:flex><span>  hostname: <span style=color:#e6db74>&#39;localhost&#39;</span>
</span></span><span style=display:flex><span>  port: <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>  ssl: false
</span></span><span style=display:flex><span>  suffix: <span style=color:#e6db74>&#39;_prod&#39;</span>
</span></span><span style=display:flex><span>  username: <span style=color:#e6db74>&#39;peertube&#39;</span>
</span></span><span style=display:flex><span>  password: <span style=color:#e6db74>&#39;password&#39;</span> <span style=color:#75715e># 刚刚设置的数据库密码</span>
</span></span><span style=display:flex><span>  pool:
</span></span><span style=display:flex><span>    max: <span style=color:#ae81ff>5</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>object_storage:
</span></span><span style=display:flex><span>  enabled: true <span style=color:#75715e># 改为启用</span>
</span></span><span style=display:flex><span>  endpoint: <span style=color:#e6db74>&#39;s3.us-west-002.backblazeb2.com&#39;</span> <span style=color:#75715e># 你的对象存储池终结点</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># region: &#39;us-east-1&#39; # 你的对象存储地区（如果需要的话）</span>
</span></span><span style=display:flex><span>  credentials:
</span></span><span style=display:flex><span>    access_key_id: <span style=color:#e6db74>&#39;xxxxxx&#39;</span> <span style=color:#75715e># 你的 App Key ID</span>
</span></span><span style=display:flex><span>    secret_access_key: <span style=color:#e6db74>&#39;xxxxxx&#39;</span> <span style=color:#75715e># 你的 App Key</span>
</span></span><span style=display:flex><span>  max_upload_part: 2GB
</span></span><span style=display:flex><span>  streaming_playlists:
</span></span><span style=display:flex><span>    bucket_name: <span style=color:#e6db74>&#39;PeerTube&#39;</span> <span style=color:#75715e># 你的对象存储池名字</span>
</span></span><span style=display:flex><span>    prefix: <span style=color:#e6db74>&#39;streaming-playlists:&#39;</span> <span style=color:#75715e># 串流子文件夹名，注意结尾的冒号</span>
</span></span><span style=display:flex><span>  videos:
</span></span><span style=display:flex><span>    bucket_name: <span style=color:#e6db74>&#39;PeerTube&#39;</span> <span style=color:#75715e># 你的对象存储池名字</span>
</span></span><span style=display:flex><span>    prefix: <span style=color:#e6db74>&#39;videos:&#39;</span> <span style=color:#75715e># 影片子文件夹名，注意结尾的冒号</span>
</span></span></code></pre></div><p>可以根据自己的实际需要填写，如果你不准备用对象存储，这里可以不改。串流列表和影片的池可以不是一个，如果不是一个的话，可以将两行子文件夹名用井号注释掉，如果是一个则必须要有子文件夹名。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>transcoding:
</span></span><span style=display:flex><span>  enabled: false <span style=color:#75715e># 关闭转码</span>
</span></span></code></pre></div><p>如果你的 VPS 性能很强可以不改，一般的便宜 VPS 都不太带的动转码的工作，我建议你在自己的电脑上转好了再上传。确保视频格式为 H264 音频格式为 AAC。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tracker:
</span></span><span style=display:flex><span>  enabled: false <span style=color:#75715e>## 关闭 P2P</span>
</span></span></code></pre></div><p>因为我们的实例是自用的，开着 P2P 没什么意义，所以关掉。P2P 还会影响从对象存储串流。这里的选项并没有办法完全关闭 WebTorrent，我们后面会继续讲。</p><p>最后不要忘了保存。</p><h3 id=启动-peertube>启动 PeerTube</h3><p>这里先用 <code>Exit</code> 命令回到之前的用户下，之后启动 PeerTube 服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl enable --now peertube
</span></span></code></pre></div><p>检查一下运行有无问题：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl status peertube
</span></span></code></pre></div><p>我们还需要修改默认的管理员密码，回到 peertube 用户下操作：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>su - peertube
</span></span><span style=display:flex><span>cd peertube-latest <span style=color:#f92672>&amp;&amp;</span> NODE_CONFIG_DIR<span style=color:#f92672>=</span>/var/www/peertube/config NODE_ENV<span style=color:#f92672>=</span>production npm run reset-password -- -u root
</span></span></code></pre></div><p>注意此处因为要拉起 Node.js，到出现输入密码提示的速度非常慢，如果误操作多按了回车什么的，可以用 Crtl+C 取消重来。</p><p>完成后再次用 <code>Exit</code> 命令回到之前的用户下。</p><h2 id=安装-caddy>安装 Caddy</h2><p>Caddy 是一款非常现代且易于配置的 Web 服务器，还可以自动从 Let&rsquo;s Encrypt 签发 HTTPS 证书，我也很推荐你在其他场合尝试使用 Caddy。</p><p>用以下命令添加 Caddy 的源并安装：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https
</span></span><span style=display:flex><span>curl -1sLf <span style=color:#e6db74>&#39;https://dl.cloudsmith.io/public/caddy/stable/gpg.key&#39;</span> | sudo tee /etc/apt/trusted.gpg.d/caddy-stable.asc
</span></span><span style=display:flex><span>curl -1sLf <span style=color:#e6db74>&#39;https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt&#39;</span> | sudo tee /etc/apt/sources.list.d/caddy-stable.list
</span></span><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install caddy
</span></span></code></pre></div><p>编辑 Caddy 配置文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo nano /etc/caddy/Caddyfile
</span></span></code></pre></div><p>将文件的内容替换为以下内容并保存：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>peertube.imlala.best <span style=color:#f92672>{</span> <span style=color:#75715e># 你的域名</span>
</span></span><span style=display:flex><span>        reverse_proxy 127.0.0.1:9000
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>启动 Caddy 服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl enable --now caddy
</span></span></code></pre></div><p>检查运行有无问题：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl status caddy
</span></span></code></pre></div><p>此时如果出现端口被占用的问题，说明你可能在运行 nginx 一类的其他 Web 服务器。如果出现无法注册 HTTPS 证书一类的问题，可以检查一下防火墙和 CDN 配置，比如关掉 Cloudflare 的代理再试。</p><p>现在你可以打开你的网站试试看了，如果不出意外应该已经可以打开了。你可以用 root 和刚才设置的密码来登录。如果访问不了可以检查防火墙配置。</p><h2 id=其他必要配置>其他必要配置</h2><p>在 PeerTube 的管理页面中我们可以对服务器做进一步的自定义。我这里挑选一些重要的来讲一下。</p><h3 id=管理面板>管理面板</h3><p>首先我建议你安装 privacysettings 插件，它可以将新上传的影片锁定为站内访问，对一个自用的节点非常实用。</p><p>在 Configuration > Basic 下，你可以将 SEARCH 和 FEDERATION 里面的项目全部勾掉，来进一步提高自闭程度。记得点保存设置。</p><h3 id=我的账户面板>我的账户面板</h3><p>还记得我们刚才提到的 P2P 影响对象存储访问的问题吗？我很怀疑这其实是一个 Bug，在 Tracker 已经被禁用的情况下，P2P 应该不可用才对，但 Web Torrent 却还在浏览器上运行。这基本上等于是把我们用来提速的对象给存储架空了。即便在不用对象存储的条件下，我依然发现它要比直连慢得多，对于私人使用来说怎么都是关掉为好。</p><p>我们需要在 “我的账户” 的 Settings 中找到 “帮助分享正在播放的视频” 勾掉。记得点保存设置。这一选项需要在每个用户的设置里面进行调整，非常的麻烦，不过因为我们是自己用，所以影响不是特别大。希望这一问题能在以后的版本中得到解决。</p><p>PeerTube 的中文翻译也不是很完整，有时候有有时候没有。</p><h2 id=排错>排错</h2><p>在 PeerTube 的 “管理” 的 “系统” 菜单下的 Jobs 中可以看到正在执行的任务。如 “move-to-object-storage ” 就是将上传的视频移动到对象存储的任务，你可以在其报告中看到一些相关的错误提示。如果对象存储无法访问，可以检查 CORS 是否正确，极端情况下可以先改成允许所有网站访问进行测试。还有可能是因为对象存储没有设置为 Public。</p><p>如完全按照本教程配置，播放器应该会在播放时右下角显示 HTTP 字样（电脑版页面），而不是上传下载速度，否则请检查是否已关闭 “帮助分享正在播放的视频”。</p><h2 id=参考资料>参考资料</h2><p><a href=https://github.com/Chocobozzz/PeerTube/>PeerTube Github</a></p><p><a href=https://docs.joinpeertube.org/>PeerTube Docs</a></p><p><a href=https://lala.im/7688.html>荒岛 PeerTube v3：终于支持直播功能啦</a></p><p><a href=https://zhuanlan.zhihu.com/p/357738044>知乎 Xpitz PeerTube 安装教程：如何搭建视频分享平台</a>（想要用 Docker 装的可以参考此文）</p><h2 id=结语>结语</h2><p>我早就有想搭一个 PeerTube 的想法但是一直没有付诸实践，主要就是因为安装过于麻烦。这次教程用自用节点的角度尽可能细致的梳理了安装步骤，希望能够帮到有同样想法的朋友。</p></section></article></main><footer class="mx-auto flex h-[4.5rem] max-w-(--w) items-center px-8 text-xs tracking-wider uppercase opacity-60"><div class=mr-auto>&copy;2025
<a class=link href=https://blog.megabits.xyz/>🍤 金鱼的记忆仓库</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>powered by hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>hugo-paper</a></footer></body></html>